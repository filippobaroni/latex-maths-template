\ProvidesPackage{filbar-common}[2025/02/26 v0.1 FilBar Common Styles]

% Support for colours
\RequirePackage{xcolor}

% SETTINGS
% Footer rule
\newlength{\filbar@footerthickness}
\setlength{\filbar@footerthickness}{.75pt}
\colorlet{filbar@footer rule color}{black!30}

% Process options
\ProcessOptionsX\relax

% FONTS
% Use the latinmodern font package
\RequirePackage{lmodern}

% Commands to set the theme color
\NewDocumentCommand{\FilBarSetThemeColor}{m}{
\colorlet{filbar theme color}{#1}
\FilBar@PostSetThemeColor{}
}
\NewDocumentCommand{\FilBarDefineThemeColor}{mm}{
\definecolor{filbar theme color}{#1}{#2}
\FilBar@PostSetThemeColor{}
}
\NewDocumentCommand{\FilBar@PostSetThemeColor}{}{
\FilBarMakeBullets{}
}
% Default theme color
\AtEndOfClass{\FilBarSetThemeColor{black!50}}

% SECTIONS
% Customise the section headings
% We want the last number in the section/subsection number to be coloured.
% The default formatting looks like this:
% \newcommand*{\sectionformat}{\thesection\autodot\enskip}
% We modify these, instead of redefining the low-level commands \thesection and \thesubsection,
% so as not to interfere with (for instance) references to sections.
\renewcommand*{\sectionformat}{\textcolor{filbar theme color}{\thesection}\autodot\enskip}
% The default definition for \thesubsection is:
% \thesection .\@arabic \c@subsection
\renewcommand*{\subsectionformat}{\thesection .\textcolor{filbar theme color}{\@arabic\c@subsection}\autodot\enskip}
% Redefine subsubsectionformat to be inline.
\renewcommand*{\subsubsectionformat}{\thesubsection .\textcolor{filbar theme color}{\@arabic\c@subsubsection}\autodot\enskip}
\RedeclareSectionCommand[runin=true]{subsubsection}

% PARAGRAPHS
% Customise the paragraph headings
% I don't plan to ever number paragraphs, but it'd be nice to have some custom formatting.
\RequirePackage{xstring} % To get the last character
\NewCommandCopy{\oldparagraph}{\paragraph}
\renewcommand*{\paragraph}[1]{%
\StrGobbleRight{#1}{1}[\filbar@parwithoutlast]%
\StrRight{#1}{1}[\filbar@parlast]%
\oldparagraph{\filbar@parwithoutlast\textcolor{filbar theme color}{\filbar@parlast}}%
}

% FOOTNOTES
% Set the footnote mark to be coloured and bold.
% This is for the mark in the actual footnote:
\addtokomafont{footnotelabel}{\bfseries\color{filbar theme color}}
% This is for the mark in the text:
\addtokomafont{footnotereference}{\bfseries\color{filbar theme color}}

% FOOTER
% The standard way to customise the footer in KOMA-Script is to use the scrlayer-scrpage package.
\RequirePackage{scrlayer-scrpage}
% Pagestyle needs to be set in the class file (different for article and thesis)
% \pagestyle{scrheadings} or \pagestyle{plain.scrheadings}
% Customise the footer
\cfoot*{
\begin{tikzpicture}[
evaluate={\offset=\filbar@footerthickness/2;}] % Very small offset, to compensate for the line width and avoid overfull hbox
\node[outer sep=0,inner xsep=.6em,inner ysep=0] (p) at (\textwidth/2,0) {\pagemark}; % The page mark
\begin{pgfinterruptboundingbox} % Ignore the rule in the bounding box
\draw[filbar@footer rule color,line width=\filbar@footerthickness,line cap=round] % Set colour, line width and line cap of the footer rule
({\offset pt},0) -- (p) -- ({\textwidth-(\offset pt)},0); % The rule, from left to page mark to right
\end{pgfinterruptboundingbox}
\end{tikzpicture}
}

% FIGURE BOX
% Customise the appearance of figures, using package tcolorbox
\RequirePackage{tcolorbox}
\tcbuselibrary{skins}
\tcbset{empty figure box/.style={
    blanker,
    oversize=-1em
}}
\newtcolorbox{empty figure box}{
empty figure box
}
\newtcolorbox{figure box with footer}{
empty figure box,
bottom=.75em,
borderline south={\filbar@footerthickness}{0pt}{draw=filbar@footer rule color,line cap=round},
}
\RequirePackage{filbar-figures}
\def\filbar@afterfigurebegin{\begin{figure box with footer}\center}
\def\filbar@beforefigureend{\end{figure box with footer}}

% TIKZ
% Load TikZ
\RequirePackage{tikz}


% Load additional files
% Decorations (bullet points, etc.)
\input{filbar-decorations.sty}

% LISTS
% Custom lists (enumroman, enumarabic)
\usepackage{filbar-lists}
% Custom itemize bullet points
\newsavebox{\filbar@box@itemizebulleti}
\NewDocumentCommand{\FilBarMakeBullets}{}{
\savebox{\filbar@box@itemizebulleti}{\FilBarBulletPointI{}}
}

\setlist[itemize,1]{
    % label=$\bullet$,
label=\usebox{\filbar@box@itemizebulleti},
% label=\ooalign{\hfil\scalebox{.5}{\textcolor{filbar theme color}{$\bullet$}}\hfil\cr$\circ$}
}